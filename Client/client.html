<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<title>Test Client</title>
	</head>
	<body>
		<div class="container-fluid">
			<h1>Catan Game</h1>
			<div class="row">
				<div class="col-sm-12 col-lg-9">
					<canvas id='board' width="600" height="600" style='border: 1px solid black;'>
					</canvas>
				</div>
				<div class="col-sm-12 col-lg-3">
					Other players
				</div>
			</div>
			<div class="row">
				<div class="col-sm-12 col-lg-9">
					Your stuff
				</div>
				<div class="col-sm-12 col-lg-3">
					Actions
				</div>
			</div>
		</div>
	</body>
</html>


<script>
	
	var NONE = "";
	var GAMESTATE_BOARD = "STATE BOARD";
	
	var socket;
	
	var expectedMessage = NONE;
	var board = {};
	
	var SHEEP_COLOR = "#a8d242";
	var WHEAT_COLOR = "#ffd300";
	var BRICK_COLOR = "#d77b42";
	var STONE_COLOR = "#797979";
	var WOOD_COLOR = "#33a642";
	var DESERT_COLOR = "#fffdb9";
	var WATER_COLOR = "#3daad6";
	var NORMAL_NUMBER_COLOR = "#000000";
	var RED_NUMBER_COLOR = "#ff0000";
	var ROBBER_COLOR = "#7f7f7f";
	var NUMBER_BG_COLOR = "#fff";
	var ALL_PORT_COLOR = "#bbb";
	
	var HEX_HEIGHT = 87;
	var HEX_WIDTH = 100;
	var HEX_SIDE = 50;
	
	$(document).ready(function (){
		socket = new WebSocket("ws://127.0.0.1:1185");
		
		socket.onmessage = function(event) {
			if(expectedMessage == NONE) {
				expectedMessage = event.data;
			} else if(expectedMessage = GAMESTATE_BOARD) {
				board = JSON.parse(event.data);
				drawBoard();
			}
		}
		
	});
	
	function drawBoard() {
		var canvas = $("#board")[0].getContext('2d');
		canvas.fillStyle = WATER_COLOR;
		canvas.fillRect(0, 0, 600, 600);
		var xOffsetGlobal = $("#board")[0].width / 2 - 5 * HEX_WIDTH / 2 * 3 / 4;
		var yOffsetGlobal = $("#board")[0].height / 2 - 5 * HEX_HEIGHT / 2;
		console.log(board);
		var tiles = board.tiles;
		for(var i = 0; i < tiles.length; i++) {
			for(var j = 0; j < tiles[i].length; j++) {
				if(tiles[i][j] != null) {
					if(tiles[i][j].resource == "Wheat") {
						canvas.fillStyle = WHEAT_COLOR;
					} else if(tiles[i][j].resource == "Sheep") {
						canvas.fillStyle = SHEEP_COLOR;
					} else if(tiles[i][j].resource == "Stone") {
						canvas.fillStyle = STONE_COLOR;
					} else if(tiles[i][j].resource == "Brick") {
						canvas.fillStyle = BRICK_COLOR;
					} else if(tiles[i][j].resource == "Wood") {
						canvas.fillStyle = WOOD_COLOR;
					} else if(tiles[i][j].resource == "None") {
						canvas.fillStyle = DESERT_COLOR;
					} 
					var xOffset = j * HEX_WIDTH * 3 / 4;
					var yOffset = i * HEX_HEIGHT - j * HEX_HEIGHT / 2;
					
					canvas.beginPath();
					var x = xOffset + xOffsetGlobal + HEX_WIDTH / 4;
					var y = yOffset + yOffsetGlobal;
					canvas.moveTo(x, y);
					x += HEX_WIDTH / 2;
					canvas.lineTo(x, y);
					x += HEX_WIDTH / 4;
					y += HEX_HEIGHT / 2;
					canvas.lineTo(x, y);
					x -= HEX_WIDTH / 4;
					y += HEX_HEIGHT / 2;
					canvas.lineTo(x, y);
					x -= HEX_WIDTH / 2;
					canvas.lineTo(x, y);
					x -= HEX_WIDTH / 4;
					y -= HEX_HEIGHT / 2;
					canvas.lineTo(x, y);
					
					canvas.closePath();
					canvas.fill();
					
					canvas.strokeStyle = "#000";
					canvas.beginPath();
					x = xOffset + xOffsetGlobal + HEX_WIDTH / 4;
					y = yOffset + yOffsetGlobal;
					canvas.moveTo(x, y);
					x += HEX_WIDTH / 2;
					canvas.lineTo(x, y);
					x += HEX_WIDTH / 4;
					y += HEX_HEIGHT / 2;
					canvas.lineTo(x, y);
					x -= HEX_WIDTH / 4;
					y += HEX_HEIGHT / 2;
					canvas.lineTo(x, y);
					x -= HEX_WIDTH / 2;
					canvas.lineTo(x, y);
					x -= HEX_WIDTH / 4;
					y -= HEX_HEIGHT / 2;
					canvas.lineTo(x, y);
					
					canvas.closePath();
					canvas.stroke();
					
					if(tiles[i][j].resource != "None") {
						var horizontalOffset = xOffset + xOffsetGlobal + HEX_WIDTH / 2;
						var verticalOffset = yOffset + yOffsetGlobal + HEX_HEIGHT / 2
						
						canvas.fillStyle = NUMBER_BG_COLOR;
						canvas.beginPath();
						canvas.arc(horizontalOffset, verticalOffset, 20, 0, 2 * Math.PI);
						canvas.fill();
						
						
						canvas.font = "20px Arial";
						if(tiles[i][j].roll == 6 || tiles[i][j].roll == 8) {
							canvas.fillStyle = RED_NUMBER_COLOR;
						} else {
							canvas.fillStyle = NORMAL_NUMBER_COLOR;
						}
						var textWidth = canvas.measureText(tiles[i][j].roll).width;
						canvas.fillText(tiles[i][j].roll, horizontalOffset - textWidth / 2, verticalOffset + 7);
					}
				}
			}
		}
	
		var spaces = board.spaces;
		for(var i = 0; i < spaces.length; i++) {
			var space = spaces[i];
			
			if(space.building != null) {
				var x = xOffsetGlobal + space.column * HEX_WIDTH * 3 / 4 + HEX_WIDTH / 4;
				var y = yOffsetGlobal + space.diagonal * HEX_HEIGHT - space.column * HEX_HEIGHT / 2;
				
				if(space.position >= 1) {
					x += HEX_WIDTH / 2;
				}
				if(space.position >= 2) {
					x += HEX_WIDTH / 4;
					y += HEX_HEIGHT / 2;
				}
				if(space.position >= 3) {
					x -= HEX_WIDTH / 4;
					y += HEX_HEIGHT / 2;
				}
				if(space.position >= 4) {
					x -= HEX_WIDTH / 2;
				}
				if(space.position >= 5) {
					x -= HEX_WIDTH / 4;
					y -= HEX_HEIGHT / 2;
				}
				canvas.fillStyle = "#000";
				canvas.beginPath();
				canvas.arc(x, y, 10, 0, 2 * Math.PI);
				canvas.closePath();
				canvas.fill();
			}
		}
	
		var links = board.links;
		for(var i = 0; i < links.length; i++) {
			var x = [];
			var y = [];
			x.push(xOffsetGlobal + links[i].column * HEX_WIDTH * 3 / 4 + HEX_WIDTH / 4);
			x.push(xOffsetGlobal + links[i].column * HEX_WIDTH * 3 / 4 + HEX_WIDTH * 3 / 4);
			x.push(xOffsetGlobal + links[i].column * HEX_WIDTH * 3 / 4 + HEX_WIDTH);
			x.push(xOffsetGlobal + links[i].column * HEX_WIDTH * 3 / 4 + HEX_WIDTH * 3 / 4);
			x.push(xOffsetGlobal + links[i].column * HEX_WIDTH * 3 / 4 + HEX_WIDTH / 4);
			x.push(xOffsetGlobal + links[i].column * HEX_WIDTH * 3 / 4);
			
			y.push(yOffsetGlobal + links[i].diagonal * HEX_HEIGHT - links[i].column * HEX_HEIGHT / 2);
			y.push(yOffsetGlobal + links[i].diagonal * HEX_HEIGHT - links[i].column * HEX_HEIGHT / 2);
			y.push(yOffsetGlobal + links[i].diagonal * HEX_HEIGHT - links[i].column * HEX_HEIGHT / 2 + HEX_HEIGHT / 2);
			y.push(yOffsetGlobal + links[i].diagonal * HEX_HEIGHT - links[i].column * HEX_HEIGHT / 2 + HEX_HEIGHT);
			y.push(yOffsetGlobal + links[i].diagonal * HEX_HEIGHT - links[i].column * HEX_HEIGHT / 2 + HEX_HEIGHT);
			y.push(yOffsetGlobal + links[i].diagonal * HEX_HEIGHT - links[i].column * HEX_HEIGHT / 2 + HEX_HEIGHT / 2);
			
			var xPts = [];
			var yPts = [];
			
			if(links[i].position == 0) {
				xPts.push(x[5]);
				xPts.push(x[0]);
				yPts.push(y[5]);
				yPts.push(y[0]);
			} else if(links[i].position == 1) {
				xPts.push(x[0]);
				xPts.push(x[1]);
				yPts.push(y[0]);
				yPts.push(y[1]);
			} else if(links[i].position == 2) {
				xPts.push(x[1]);
				xPts.push(x[2]);
				yPts.push(y[1]);
				yPts.push(y[2]);
			} else if(links[i].position == 3) {
				xPts.push(x[2]);
				xPts.push(x[3]);
				yPts.push(y[2]);
				yPts.push(y[3]);
			} else if(links[i].position == 4) {
				xPts.push(x[3]);
				xPts.push(x[4]);
				yPts.push(y[3]);
				yPts.push(y[4]);
			} else if(links[i].position == 5) {
				xPts.push(x[4]);
				xPts.push(x[5]);
				yPts.push(y[4]);
				yPts.push(y[5]);
			}
			
			if(links[i].road != -1) {
				canvas.lineWidth = 5;
				canvas.beginPath();
				canvas.moveTo(xPts[0], yPts[0]);
				canvas.lineTo(xPts[1], yPts[1]);
				canvas.closePath();
				canvas.stroke();
			}
		}
	}
	
	function addPort(resource, offset, triangle) {
		
	}
	
	function addHex(tile, horizontalOffset, verticalOffset, points) {
		
	}
</script>
